`bill-api` - сервис-прослойка между внутренними сервисами (`subscription`) и внешними сервисами оплаты ([Yookassa](https://yookassa.ru/developers/api))

Для запуска можно использовать `compose.dev.yml`
(`compose.yml` использовать не получится из-за закрытых портов; будет использоваться только в составе остальных сервисов):

```sh
docker compose -f compose.dev.yml up --build -d
```

Сервис будет доступен по адресу http://127.0.0.1:8008/api/openapi


## Использование внутренними сервисами
Для опаты, сервису нужно вызывать `/api/v1/payment`, с указанием:
* `user_id` - пользователя
* `amount`, `currency` - количества валюты
* `return_url` - адреса для возврата со страницы внешнего сервиса оплаты
* `handler_url` - (опционально) URL веб-хука обработчика
* `extra_data` - (опционально) дополнительных данных, передаваемых обработчику

Для возврата, сервису нужно вызывать `/api/v1/payment/{id}/refund`, с указанием:
* `amount`, `currency` - количества валюты
* `handler_url` - (опционально) URL веб-хука обработчика
* `extra_data` - (опционально) (опционально) дополнительных данных, передаваемых обработчику

Для полученния результата оплаты/возрата, внутренний сервис использует либо веб-хук, либо считывает kafka топики `payment`/`refund`.

Веб-хук будет вызываться до тех пор, пока не вернет HTTP статус 200.

И веб-хук, и kafka консьюмер должны быть идемпотентными, то есть быть готовыми получить одно и то же сообщение несколько раз.

В обоих случаях уведомление (о результате операции) будет представлено в виде json объекта:
* `id` - оплаты или возврата
* `status` - `succeeded` или `cancelled`
* `external_cancellation_reason` - указан при статусе `cancelled`
* `extra_data` - дополнительные данные, переданные при вызове оплаты/возврата